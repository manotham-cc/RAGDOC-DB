# Streamlit UI Implementation Plan

## 1. Project Overview

The goal is to implement a user-friendly web interface for the RAGSQL application using Streamlit. This UI will allow users to input natural language questions, view the AI-generated summary, inspect the corresponding SQL query, and maintain a persistent chat history within the session.

## 2. Prerequisites

Before starting, ensure you have the following:
-   make requirements.txt by ref pyproject.toml
-   Python 3.11+ installed.
-   The RAGSQL backend (including the `db` and `chat_history_db` Docker containers) is set up and running.
-   All Python dependencies for RAGSQL are installed (e.g., `uv pip install -r requirements.txt`,`uv add`).
-   Install Streamlit:
    ```bash
    uv pip install streamlit
    ```

## 3. Core UI Components

The Streamlit application will feature the following main UI elements:

-   **Title and Description:** A clear title and a brief explanation of the application's purpose.
-   **Chat History Display:** A section to show the ongoing conversation, including user questions and AI responses (summaries).
-   **User Input Field:** A text input box for users to type their natural language questions.
-   **Submit Button:** To trigger the processing of the user's question.
-   **AI Summary Output:** A dedicated area to display the AI-generated summary of the query results.
-   **Generated SQL Output:** An expandable section to show the raw SQL query generated by the LLM.
-   **Session Management:** Hidden logic to manage a unique session ID for chat history persistence.

## 4. Integration with RAGSQL Backend

The Streamlit UI will interact with the existing RAGSQL Python modules:

-   **Import necessary functions:** `get_summary`, `save_chat_history`, `get_chat_history` from the `ragsql` package.
-   **Session State:** Utilize Streamlit's `st.session_state` to store and manage the unique `session_id` and the current chat history for the UI.
-   **Function Calls:** Call `get_summary` with the user's question and the current `session_id`.
-   **History Persistence:** Call `save_chat_history` after each interaction to store the conversation in the database.
-   **History Retrieval:** Call `get_chat_history` to load previous conversation turns for display and context.

## 5. Step-by-Step Implementation

### 5.1. Setup Streamlit Application File

Create a new Python file, `streamlit_app.py`, in the root directory of your project.

### 5.2. Basic UI Structure

-   Import `streamlit as st`.
-   Set the page title and a brief description.
-   Initialize `st.session_state` for `session_id` and `messages` (chat history).

### 5.3. Initialize Session State

-   If `session_id` is not in `st.session_state`, generate a new `uuid` and store it.
-   If `messages` is not in `st.session_state`, initialize it as an empty list.

### 5.4. Display Chat History

-   Iterate through `st.session_state.messages` and display each message using `st.chat_message`.

### 5.5. Handle User Input

-   Use `st.chat_input` to capture the user's natural language question.
-   If a question is submitted:
    -   Add the user's question to `st.session_state.messages`.
    -   Display the user's question in the chat interface.

### 5.6. Integrate with RAGSQL Backend

-   Call `get_summary(st.session_state.session_id, user_question)` to get the AI's response and the generated SQL.
-   Add the AI's summary to `st.session_state.messages`.
-   Display the AI's summary in the chat interface.
-   Display the generated SQL in an expandable `st.expander`.
-   Call `save_chat_history(st.session_state.session_id, user_question, sql_query, ai_summary)` to persist the interaction.

### 5.7. Error Handling

-   Implement basic `try-except` blocks around backend calls to catch and display errors gracefully using `st.error`.

## 6. Running the Streamlit App

Navigate to your project's root directory in the terminal and run:

```bash
streamlit run streamlit_app.py
```

Then, open your web browser to the address provided by Streamlit (usually `http://localhost:8501`).

## 7. Future Enhancements (Optional)

-   **Clear Chat Button:** Add a button to clear the current session's chat history.
-   **Loading Indicators:** Implement `st.spinner` or other visual cues during LLM processing.
-   **Configuration UI:** Allow users to configure LLM parameters or database connections via the UI.
-   **SQL Execution UI:** Add a feature to execute the generated SQL directly from the UI and display results.
